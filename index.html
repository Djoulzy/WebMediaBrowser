<!DOCTYPE html>
<html>
<head lang="en">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<title>Cute file browser</title>
	<!-- Include our stylesheet -->
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/dark-hive/jquery-ui.css">
	<link type="text/css" rel="stylesheet" href="assets/js/plupload/jquery.ui.plupload/css/jquery.ui.plupload.css" media="screen" />
	<link href="assets/css/styles.css" rel="stylesheet"/>
</head>
<body>
	<p class="copyright">CopyRight&copy;Watchever_2017 - v1.3 (25/09/2017)</p>
	<div class="filemanager">

		<!-- <div class="search">
			<input type="search" placeholder="Find a file.." />
		</div> -->

		<div class="breadcrumbs"></div>

		<div class="uploader" id="uploader">
		    <p>Your browser doesn't have HTML5 support.</p>
		</div>

		<ul class="data"></ul>

		<div class="nothingfound">
			<div class="nofiles"></div>
			<span>No files here.</span>
		</div>

		<div id="dialog" class="dialog" title="Media Details"></div>
	</div>
	<!-- <footer>
        <a class="tz" href="http://tutorialzine.com/2014/09/cute-file-browser-jquery-ajax-php/">Cute File Browser with jQuery, AJAX and PHP</a>
        <div id="tzine-actions"></div>
        <span class="close"></span>
    </footer> -->

	<!-- Include our script files -->
	<script type="text/javascript" src="config.js"></script>
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js" integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="assets/js/plupload/plupload.full.min.js"></script>
	<script type="text/javascript" src="assets/js/plupload/jquery.ui.plupload/jquery.ui.plupload.js" charset="UTF-8"></script>
	<script type="text/javascript">

		String.prototype.replaceAll = function(search, replacement) {
		    var target = this;
		    return target.replace(new RegExp(search, 'g'), replacement);
		}

		function titlelize(title) {
		   return title.replace(/(^|[. ]+)(\S)/g, function(all, pre, c) { return ((pre) ? ' ' : '') + c.toUpperCase(); });
		};

		function extractData(it, html) {
			var res = it.replaceAll("_", " ");
			var regex = /^(.+?)[.( \t]*((19\d{2}|20(?:0\d|1[0-9])).*|(?:(?=\d+p|bluray|brrip|webrip|hdlight|dvdrip|web-dl|hdrip)..*)?[.](mkv|avi|mpe?g|mp4)$)/i;
			var regex2 = /^(.+?)(bluray|brrip|webrip|hdlight|dvdrip|web-dl|hdrip)(?:.+?)$/i;
			var regex3 = /^(.+?)(?:[^\d](\d+p)[^p])(?:.*?)$/i;
			var regex4 = /^(?:.+?)(multi|vf(?:\w*)|(?:\w*)french)(?:.+?)$/i;

		   var out = new Array(5);

		   if ( m = regex.exec(res) ) {
			   out[0] = titlelize(m[1]) || '-'; // Title
			   out[1] = m[3] || '-';	// Year
			   tmp = m[2].replaceAll("\\.", " ");
			//    tmp = tmp.replaceAll("-", " ");
			   if ( n = regex2.exec(tmp) ) {
				   out[2] = n[2] || '-'; // Origine
				   if ( o = regex3.exec(n[1]) ) {
					   out[3] = o[2] || '-'; // Qualite
				   }
			   }
			   if ( p = regex4.exec(tmp) ) out[4] = p[1] || '-'; // Langue
			   else out[4] = '-';
		   } else {
		       out[0] = '<font color="red">No match</font>';
		   }
		   //the replace is an hack to remove html in live input text
		//    return (html) ? out : out.replace(/<[^>]+>|&[^;]+;/g,'');
		return out;
		}

		$(function() {
		    $("#uploader").plupload({
		        // General settings
		        runtimes : 'html5',
				php_uploader: '/assets/php/upload.php',
		        url : '',
				unique_names : false,

		        // Maximum file size
		        max_file_size : '10Gb',
		        chunk_size: '20mb',

		        // Specify what files to browse for
		        filters : [
		            {title : "VIDEO files", extensions : "mkv,avi,mp4"}
		        ],

		        // Rename files by clicking on their titles
		        rename: true,

		        // Sort files
		        sortable: true,

		        // Enable ability to drag'n'drop files onto the widget (currently only HTML5 supports that)
		        dragdrop: true,

		        // Views to activate
		        views: {
            		thumbs: true,
		            active: 'thumbs'
		        },

				// Post init events, bound after the internal events
				init : {
					BeforeUpload: function(up, file) {
						up.settings.url = up.settings.php_uploader + '?dest=' +window.actual_dir;
					},
					UploadComplete: function(up, files) {
						window.location.reload(true);
					},
				}
		    });
		});
	</script>
	<script src="assets/js/script.js"></script>
</body>
</html>
